---
title: 전자 서명과 인증서
excerpt: 신뢰를 위한 수단

toc: true
toc_label: About
toc_sticky: true

categories: nw

date: 2022-05-26
last_modified_at: 2022-05-26
---

<br><br>
![Header](/assets/images/nonsafesit.jpg)<br><br>
보안 인증서에 문제가 있다라는 사이트를 본 적이 있다. '인증서'가 무엇을 뜻하고 인증서에 기반한 보안에 대해서 공부해보자.<br><br>

# 신뢰할 만한 데이터
다음과 같은 상황을 가정해보자. 대한민국의 1000만명의 사용자들이 네이버에서 만든 'A'라는 앱을 사용하고 있고 사용자가 컴퓨터를 부팅하면 자동으로 A가 업데이트된다고 한다. 어느날 공격자가 DDOS 공격을 시도하여 A를 관리하는 특정 네이터 서버에 악성코드를 심어두었다. 만일 사용자가 컴퓨터를 키고 아무런 보안 수단 없이 서버로 부터 데이터를 받아와 업데이트를 진행한다면 컴퓨터는 좀비 PC가 되어 공격자의 손아귀로 넘어간다. 그러나 업데이트를 진행하기 전 해당 네이버 서버가 진짜 네이버가 관리하는 서버인지 그리고 업데이트틀 진행하고자 하는 데이터가 조작되었는지를 검사할 수 있다면 사용자 PC가 좀비 PC가 되는 것을 막을 수 있다. 전자 서명이 여기서 빛을 바란다.<br><br>

# 인증서 - 이 소고기는 국내산이고 등급은 투뿔입니다.
인증서의 이해를 돕기 위해서 데이터 무결성을 확인하기 전에 다음과 같은 예시를 기술한다. 우리가 마트에서 먹거리를 살 때 원산지를 본다. 중국이면 음... 그러는 것 처럼 우리는 누군가가 인증해준 마크를 기반으로 소비를 하는데 인터넷도 마찬가지다. 우리가 크롬이나 사파리를 통해 웹 서핑을 하는 것은 좋으고 빠르니까도 있지만 이 인식의 기반에서는 믿을 만해서이다. 우리가 브라우저를 통해서 웹 서핑을 하는 과정에는 보안이 필요하다. 브라우저는 우리의 정보가 공격자로 부터 빼았기지 않고 안전한 데이터를 웹으로 부터 전달 받을 수 있어야한다. 이를 위하여 브라우저는 통신 시 여러 암호 기법으로 데이터를 보호하는데 그 중 하나가 인증서이다. 우리가 구글의 입력 창에 다음과 같이 치고 엔터를 치면 크롬은 네이버의 서버로 부터 데이터를 전달받아 렌더링한다.<br>

## 인증서 인증 과정
![Header](/assets/images/네이버입력.png)<br><br>
우리가 주목해야하는 점은 엔터를 쳤을 때 서버가 어떠한 데이터를 어떻게 주었는지이다. 서버는 사용자에게 데이터를 암호화해서 공개키와 인증서를 함께 보낸다. 인증서를 전달받은 사용자는 인증기관의 공개키를 사용하여 인증서가 해당 사이트가 인증기관으로부터 인증받은 유효한 인증서인지 확인한다. 인증서 검사 과정은 다음과 같다.<br>
   - 전달받은 인증서에서 전자서명과 데이터를 분리한다<br>
   - 데이터를 해쉬함수에 입력하여 결과값을 추출한다<br>
   - 전자서명을 공개키로 복호화하여 값을 추출한다<br>
   - 추출한 두 값이 같으면 해당 사이트는 인증 기관이 인증하였으므로 신뢰할 수 있다<br><br>

# 인증서를 통한 데이터 무결성 확인 및 복호화 과정
이제 원래 예시로 돌아와 인증서를 통해 서버가 업데이트를 하고자 하는 프로그램의 무결성을 따져보자. 사용자가 서버로부터 다운받은 데이터에는 바이너리 데이터(암호화된), 인증서 그리고 네이버 서명이 들어있다. 인증서는 인증기관으로 부터 발급받은 인증서이고 당신이 안전 서버로부터 해당 프로그램을 다운받았음을 인증받았다는 것을 증명해준다. 신뢰기관에서 인증을 했는지 안했는지는 위 예시와 똑같이 이루어진다.<br>
우리가 다운받은 바이너리 데이터를 복호화하기 전에 데이터가 조작되었는지를 확인해야한다. 데이터 무결성이 지켜졌는지 안지켜졌는지를 확인해야된다는 것이다. ( 이러한 이슈를 확인하기 위해서 지금까지 나열한 과정들을 설명한것이다. ) 과정은 다음과 같다.<br>
- 사용자는 바이너리데이터를 인증서에 적힌 공개키로 복호화를 한다.
- 복호화된 데이터를 해쉬함수에 넣어 값을 추출한다.
- 네이버의 서명값을 복호화하여 값을 추출한다.
- 추출한 두 값이 동일하면 데이터가 조작되지 않았음을 뜻하고, 동일하지 않으면 조작되었음을 알 수 있다.
이런 일련의 과정들을 거쳐 사용자가 다운받은 데이터를 실행할지 안할지를 결정한다. <br><br>

## 데이터가 정말 무결한가?
이 일련의 복잡한 과정이 정말 데이터가 무결하다는 것을 보장할 수 있을까? 전문가들이 그렇다고 한다. 먼저 해쉬함수의 특징을 살펴보자. 위에서 보면 서버는 배포할 데이터를 해쉬함수에 넣고 값을 개인키로 암호화했다. 여기서 데이터의 특정 비트를 변형시키고 해쉬함수를 돌린다면 이전 데이터를 해쉬함수를 통해 추출한 값과 완전 다른 값이 나온다. 이런 특징에 착안하여 만일 해커가 데이터를 조작한 상황을 생각해보자. 사용자는 해커가 받은 데이터를 해쉬함수에 집어 넣어 데이터를 추출하여 값을 추출하고, 서명을 공개키로 복화하여 값을 추출해 비교할 것이다. 해커가 조금이라도 다른 데이터를 보냈으므로 해쉬함수를 돌리면 완전히 다른 값이 추출될 것이다. 그러므로 사이트가 신뢰하다고 판단되어도 데이터가 조작되었다는 것을 인지할 수 있다.<br><br>

정보 더 필요
